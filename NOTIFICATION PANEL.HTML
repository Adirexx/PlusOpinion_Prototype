<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PlusOpinion Notifications</title>

    <!-- Favicon for browser tabs -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icon-192.png">

    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#020205"> 
    <link rel="icon" href="./icon-192.png">
    <link rel="icon" href="./icon-512.png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">

    <!-- Global Design System -->
    <link rel="stylesheet" href="./global.css">

    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#020205">
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./runtime.js"></script>
    <script src="./bridge.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <!-- Visual Tokens & Global CSS -->
    <style>
        :root {
            --bg-deep: #020205; 
            --neon: #2f8bff;
            --muted: rgba(255, 255, 255, 0.6);
            --card: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.06);
            --danger: #FF5252;
        }

        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
            background-color: var(--bg-deep);
            color: white;
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body { display: flex; justify-content: center; align-items: center; }

        /* --- BACKGROUND --- */
        .ambient-bg {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: radial-gradient(circle at 50% 0%, #0a0e1c 0%, var(--bg-deep) 80%);
            z-index: -2; pointer-events: none; transform: translateZ(0); 
        }
        .orb {
            position: absolute; border-radius: 50%; filter: blur(90px); z-index: -1; opacity: 0.5; 
            animation: breathe 10s infinite ease-in-out alternate; will-change: opacity;
        }
        .orb-1 { top: -10%; left: -20%; width: 70vw; height: 70vw; background: radial-gradient(circle, #2f8bff, transparent); }
        .orb-2 { bottom: -10%; right: -20%; width: 80vw; height: 80vw; background: radial-gradient(circle, #4f46e5, transparent); animation-duration: 14s; }
        @keyframes breathe { 0% { opacity: 0.4; } 100% { opacity: 0.6; } }

        /* --- APP CONTAINER --- */
        #root {
            width: 100%; height: 100%; max-width: 450px; 
            background-color: rgba(3, 4, 18, 0.8); backdrop-filter: blur(20px); 
            position: relative; display: flex; flex-direction: column;
            box-shadow: 0 0 80px rgba(0,0,0,0.8); overflow: hidden;
        }

        .font-heading { font-family: 'Space Grotesk', serif; }
        
        .nav-glass {
            background: rgba(3, 4, 18, 0.95); backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
        }
        .header-glass {
            background: rgba(3, 4, 18, 0.9); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* Toast */
        .toast {
            position: absolute; bottom: 85px; left: 50%; transform: translateX(-50%);
            background: #1e1e24; color: white; padding: 12px 24px; border-radius: 12px;
            display: flex; align-items: center; justify-content: space-between; gap: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6); z-index: 100; border: 1px solid var(--glass-border);
            width: 90%; max-width: 360px;
        }
        .toast-msg { font-size: 11px; color: #9ca3af; font-weight: 500; }
        .toast-action { font-size: 13px; font-weight: 700; color: var(--neon); letter-spacing: 0.5px; }

        /* Settings/Filter Modal */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 60;
            display: flex; align-items: flex-end; /* Bottom sheet style */
        }
        .modal-content {
            background: #0A0F1D; border-top: 1px solid var(--glass-border);
            border-radius: 24px 24px 0 0; width: 100%; padding: 24px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        neon: 'var(--neon)',
                        muted: 'var(--muted)',
                        danger: 'var(--danger)',
                    },
                    fontFamily: { heading: ['Space Grotesk', 'serif'] }
                }
            }
        }
    </script>
</head>
<body>
    <div class="ambient-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { motion, AnimatePresence, useMotionValue, useTransform } = window.Motion;

        // ðŸ”— GLOBAL NAVIGATION FUNCTION
        const goTo = (page) => {
            window.scrollTo(0, 0);
            window.location.href = page;
        };

        function dispatchAction(action) {
          if (window.PlusOpinionActions && window.PlusOpinionActions[action]) {
            // Already on homepage
            window.PlusOpinionActions[action]();
          } else {
           // On another page â†’ redirect with hash
           window.location.href = `HOMEPAGE_FINAL.HTML#${action.replace('open', '').toLowerCase()}`;
          }
        }

        const triggerAction = (action) => {
            if (window.PlusOpinionActions?.[action]) {
                window.PlusOpinionActions[action]();
            } else {
                window.location.href = `HOMEPAGE_FINAL.HTML#${action.replace('open', '').toLowerCase()}`;
            }
        };
        
         // ðŸ” PAGE â†’ TAB MAP (GLOBAL)
         const PAGE_TAB_MAP = { 
           'HOMEPAGE_FINAL.HTML': 'home',
           'CATAGORYPAGE.HTML': 'categories',
           'MY SPACE FINAL (USER).HTML': 'myspace',
           'NOTIFICATION PANEL.HTML': 'notifs',
           'PRIVATE OWNER PROFILE.HTML': 'profile'
        };

        // --- ICONS ---
        const Icons = {
            Bell: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
            Trash: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            Bookmark: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>,
            Wallet: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/></svg>,
            Eye: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            Zap: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            User: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Settings: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Home: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Grid: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            Shield: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>,
            Undo: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>,
            Filter: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
            MySpaceLogo: (p) => (
                <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M11 3L3 22" strokeLinejoin="bevel"/>
                    <path d="M21 22L11 3" strokeLinejoin="bevel"/>
                    <path d="M22 8L4 18" className="myspace-swoosh" strokeWidth="2.5" />
                </svg>
            ),
            Check: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            ToggleLeft: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="12" x="2" y="6" rx="6" ry="6"/><circle cx="8" cy="12" r="2"/></svg>,
            ToggleRight: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="12" x="2" y="6" rx="6" ry="6"/><circle cx="16" cy="12" r="2"/></svg>
        };

        const Icon = ({ icon, size = 20, className = "" }) => {
            const Component = Icons[icon];
            if (!Component) return null;
            return <Component width={size} height={size} className={className} />;
        };

        const vibrate = (pattern = 5) => {
            if (typeof navigator !== 'undefined' && navigator.vibrate) navigator.vibrate(pattern);
        };

        const BRAND_LOGOS = {
            "OnePlus": "https://cdn.simpleicons.org/oneplus",
            "Samsung": "https://cdn.simpleicons.org/samsung",
            "Sony": "https://cdn.simpleicons.org/sony",
            "Ola Electric": "https://cdn.simpleicons.org/tesla", // Placeholder
            "Nike": "https://cdn.simpleicons.org/nike",
            "Dyson": "https://vectorlogo.zone/logos/dyson/dyson-icon.svg",
            "Apple": "https://cdn.simpleicons.org/apple",
            "Tesla": "https://cdn.simpleicons.org/tesla"
        };

        // --- DATA ---
        const INITIAL_DATA = [
            { id: "n1", type: "revenue", title: "Wallet Credited", desc: "You earned â‚¹12.00 for your verified review on OnePlus Nord 3.", time: "2m ago", unread: true, icon: "Wallet", tag: "+ â‚¹12.00" },
            { id: "n2", type: "brand_seen", title: "Samsung viewed your post", desc: "Your review on 'Samsung S24 Ultra' caught the brand's attention.", time: "1h ago", unread: true, icon: "Eye", brand: "Samsung" },
            { id: "n7", type: "social", title: "GamerX_99 replied", desc: "Replied to your comment on 'LG Ultragear 27': \"Totally agree about the HDR...\"", time: "3h ago", unread: true, icon: "User", avatar: "https://i.pravatar.cc/150?u=12" },
            { id: "n3", type: "system", title: "RQS Level Up", desc: "Your Reputation Quality Score increased to 84. You are now Level 1 eligible.", time: "5h ago", unread: false, icon: "Zap", tag: "Level 1" },
            { id: "n8", type: "brand_seen", title: "Ola Electric insight", desc: "Your feedback on 'Ola S1 Pro Gen 2' was marked as 'Helpful' by the brand team.", time: "6h ago", unread: false, icon: "Eye", brand: "Ola Electric" },
            { id: "n4", type: "security", title: "Security Alert", desc: "New login detected from Mumbai, IN (Chrome/Win). Was this you?", time: "1d ago", unread: false, icon: "Shield", critical: true },
            { id: "n5", type: "social", title: "Priya Sharma agreed", desc: "Priya and 12 others found your review on 'Nothing Phone (2)' helpful.", time: "2d ago", unread: false, icon: "User", avatar: "https://i.pravatar.cc/150?u=1" },
            { id: "n9", type: "system", title: "Coupon Unlocked", desc: "You've unlocked a 'Nykaa â‚¹100 OFF' coupon based on your recent activity.", time: "2d ago", unread: false, icon: "Zap", tag: "Reward" },
            { id: "n6", type: "revenue", title: "Affiliate Commission", desc: "â‚¹150 pending from your OnePlus referral link click.", time: "3d ago", unread: false, icon: "Wallet", tag: "+ â‚¹150" },
            { id: "n10", type: "brand_seen", title: "Nike team viewed", desc: "Your detailed breakdown of 'Nike Dunk Low Panda' is trending in Fashion.", time: "3d ago", unread: false, icon: "Eye", brand: "Nike" },
            { id: "n11", type: "social", title: "TechJunkie mentioned you", desc: "Mentioned you in 'Best ANC Headphones of 2025' discussion.", time: "4d ago", unread: false, icon: "User", avatar: "https://i.pravatar.cc/150?u=22" },
            { id: "n12", type: "brand_seen", title: "Dyson support replied", desc: "Official reply to your question about V15 filters.", time: "5d ago", unread: false, icon: "Eye", brand: "Dyson" }
        ];

        // --- COMPONENTS ---

        const UndoRow = ({ action, onUndo, onDismiss }) => {
            useEffect(() => {
                const timer = setTimeout(onDismiss, 5000);
                return () => clearTimeout(timer);
            }, [onDismiss]);

            return (
                <div className="relative py-4 px-4 flex items-center justify-between border-b border-white/[0.05] bg-[#020205]">
                    <span className="text-[11px] text-muted font-medium">
                        {action === 'delete' ? 'Notification deleted' : 'Saved to Bookmarks'}
                    </span>
                    <button 
                        onClick={onUndo} 
                        className="text-neon text-xs font-bold flex items-center gap-1.5 px-3 py-1.5 rounded-lg active:bg-white/[0.05] transition-colors"
                    >
                        <Icon icon="Undo" size={14} /> UNDO
                    </button>
                </div>
            );
        };

        const NotificationItem = ({ data, onSwipe, onClick }) => {
            const x = useMotionValue(0);
            
            // Text styling
            const titleClass = data.unread ? 'font-bold text-white' : 'font-medium text-slate-300';
            const descClass = data.unread ? 'text-slate-200' : 'text-slate-500';

            // --- ANIMATION VALUES ---

            // Background Color: Reddish for left swipe (delete), Blueish for right swipe (bookmark)
            // Range: -100 (Left) <-> 0 (Center) <-> 100 (Right)
            const bg = useTransform(
                x, 
                [-100, -50, 0, 50, 100], 
                ["rgba(62, 22, 22, 1)", "rgba(62, 22, 22, 0.5)", "rgba(2, 2, 5, 0)", "rgba(14, 24, 51, 0.5)", "rgba(14, 24, 51, 1)"]
            );

            // DELETE ICON (Right Side - Appears on Swipe Left/Negative X)
            // It should come from the right (positive offset relative to its position) towards center
            const deleteOpacity = useTransform(x, [-60, -20], [1, 0]); 
            const deleteScale = useTransform(x, [-100, -50], [1.2, 0.8]);
            const deleteX = useTransform(x, [-100, 0], [0, 40]); // Moves from right to left as we drag left

            // BOOKMARK ICON (Left Side - Appears on Swipe Right/Positive X)
            // It should come from the left (negative offset relative to its position) towards center
            const bookmarkOpacity = useTransform(x, [20, 60], [0, 1]);
            const bookmarkScale = useTransform(x, [50, 100], [0.8, 1.2]);
            const bookmarkX = useTransform(x, [0, 100], [-40, 0]); // Moves from left to right as we drag right

            const handleDragEnd = (_, info) => {
                if (info.offset.x < -100) onSwipe(data.id, 'delete');
                else if (info.offset.x > 100) onSwipe(data.id, 'bookmark');
            };

            return (
                <div className="relative mb-0 overflow-hidden group">
                    
                    {/* SWIPE ACTIONS LAYER - Dynamic Background & Icons */}
                    <motion.div 
                        style={{ backgroundColor: bg }}
                        className="absolute inset-0 z-0 flex items-center justify-between px-6 pointer-events-none"
                    >
                        {/* Bookmark Icon (Left side) */}
                        <motion.div 
                            style={{ opacity: bookmarkOpacity, x: bookmarkX, scale: bookmarkScale }}
                            className="text-neon flex items-center gap-2"
                        >
                            <Icon icon="Bookmark" size={24} />
                        </motion.div>

                        {/* Delete Icon (Right side) */}
                        <motion.div 
                            style={{ opacity: deleteOpacity, x: deleteX, scale: deleteScale }}
                            className="text-danger flex items-center gap-2"
                        >
                            <Icon icon="Trash" size={24} />
                        </motion.div>
                    </motion.div>

                    {/* FOREGROUND CARD */}
                    <motion.div 
                        style={{ x }}
                        drag="x"
                        dragConstraints={{ left: 0, right: 0 }}
                        onDragEnd={handleDragEnd}
                        onClick={() => onClick(data.id)}
                        className={`
                            relative py-4 px-4 flex items-start gap-4 cursor-pointer transition-colors border-b border-white/[0.05] bg-[#020205] z-10
                            active:bg-white/[0.02]
                        `}
                    >
                        {/* Unread Indicator Dot */}
                        {data.unread && (
                            <div className="absolute left-2 top-1/2 -translate-y-1/2 w-1.5 h-1.5 rounded-full bg-neon shadow-[0_0_5px_var(--neon)]"></div>
                        )}

                        {/* Icon/Avatar Container */}
                        <div className={`
                            w-10 h-10 rounded-xl flex items-center justify-center shrink-0 ml-4
                            ${data.type === 'revenue' ? 'bg-blue-500/10 text-blue-400' : 
                              data.critical ? 'bg-red-500/10 text-red-400' : 
                              'bg-white/5 text-muted'}
                        `}>
                            {data.type === 'brand_seen' && data.brand ? (
                                <img src={BRAND_LOGOS[data.brand]} alt={data.brand} className="w-5 h-5 object-contain opacity-80" />
                            ) : data.type === 'social' && data.avatar ? (
                                <img src={data.avatar} alt="User" className="w-full h-full object-cover rounded-xl opacity-90" />
                            ) : (
                                <Icon icon={data.icon} size={18} />
                            )}
                        </div>

                        <div className="flex-1 min-w-0 pt-0.5">
                            <div className="flex justify-between items-baseline mb-1">
                                <h4 className={`text-sm tracking-tight leading-snug ${titleClass}`}>
                                    {data.title}
                                </h4>
                                <span className="text-[10px] text-slate-500 whitespace-nowrap ml-2 font-medium">{data.time}</span>
                            </div>
                            <p className={`text-xs leading-relaxed line-clamp-2 ${descClass}`}>
                                {data.desc}
                            </p>
                            
                            {data.tag && (
                                <div className="mt-2">
                                    <span className="text-[10px] font-bold px-2 py-0.5 rounded border border-white/10 bg-white/5 text-white/90 inline-block">
                                        {data.tag}
                                    </span>
                                </div>
                            )}
                        </div>
                    </motion.div>
                </div>
            );
        };

        const BottomNav = ({ hasUnread, activeTab }) => (
            <div className="nav-glass absolute bottom-0 w-full h-[65px] px-2 pb-2 flex justify-between items-center z-40 transition-transform duration-300">
                <NavItem icon="Home" label="Home" onClick={() => goTo('HOMEPAGE_FINAL.HTML')} /> 
                <NavItem icon="Grid" label="Categories" onClick={() => goTo('CATAGORYPAGE.HTML')} />
                <NavItem icon="MySpaceLogo" label="My Space" isMySpace={true} onClick={() => goTo('MY SPACE FINAL (USER).HTML')} />
                <NavItem icon="Bell" label="Notifications" isActive={activeTab === 'notifs'} hasUnread={hasUnread} />
                <NavItem icon="User" label="Profile" onClick={() => goTo('PRIVATE OWNER PROFILE.HTML')} />
            </div>
        );

        const NavItem = ({ icon, label, isActive, isMySpace, hasUnread, onClick }) => (
          <button
            onClick={() => {
              vibrate(5);
              if (onClick) onClick();
            }}
                className="flex-1 flex flex-col items-center justify-center gap-1 group relative touch-scale transition-transform h-full"
            >
                <div className={`relative p-1.5 rounded-xl transition-all duration-300 ${isActive ? 'bg-white/5 scale-105' : ''}`}>
                    <Icon icon={icon} size={24} className={`transition-all duration-300 ${isActive ? 'text-white stroke-[2px]' : 'text-muted group-hover:text-white stroke-[1.5px]'}`} />
                    
                    {hasUnread && !isActive && (
                        <span className="absolute top-1 right-1 w-2 h-2 rounded-full bg-neon shadow-[0_0_8px_var(--neon)] animate-pulse"></span>
                    )}
                </div>
            </button>
        );

        // --- FILTER MODAL ---
        const FilterModal = ({ isOpen, onClose, activeFilter, onSelect }) => {
            if (!isOpen) return null;
            const filters = ['All', 'Unread', 'System', 'Brand Activity', 'Mentions'];
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content animate-slide-up" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="font-heading font-bold text-lg text-white">Filter Feed</h3>
                            <button onClick={onClose}><Icon icon="Trash" size={0} className="hidden" /><span className="text-sm text-neon font-bold">Done</span></button>
                        </div>
                        <div className="flex flex-wrap gap-3">
                            {filters.map(f => (
                                <button
                                    key={f}
                                    onClick={() => onSelect(f)}
                                    className={`px-4 py-2 rounded-full text-sm font-medium border transition-colors ${activeFilter === f ? 'bg-neon/10 border-neon text-neon' : 'bg-white/5 border-white/5 text-muted hover:border-white/20'}`}
                                >
                                    {f}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- SETTINGS MODAL ---
        const SettingsModal = ({ isOpen, onClose, settings, onToggle }) => {
            if (!isOpen) return null;
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content animate-slide-up" onClick={e => e.stopPropagation()}>
                        <h3 className="font-heading font-bold text-lg text-white mb-6">Notification Preferences</h3>
                        <div className="space-y-4">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-white font-medium">Show Unread Count</p>
                                    <p className="text-xs text-muted">Badge in header</p>
                                </div>
                                <button onClick={() => onToggle('showCount')} className="text-neon">
                                    <Icon icon={settings.showCount ? 'ToggleRight' : 'ToggleLeft'} size={32} className={settings.showCount ? 'text-neon' : 'text-muted'} />
                                </button>
                            </div>
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-white font-medium">Push Notifications</p>
                                    <p className="text-xs text-muted">Real-time alerts</p>
                                </div>
                                <button onClick={() => onToggle('push')} className="text-neon">
                                    <Icon icon={settings.push ? 'ToggleRight' : 'ToggleLeft'} size={32} className={settings.push ? 'text-neon' : 'text-muted'} />
                                </button>
                            </div>
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-white font-medium">Email Digest</p>
                                    <p className="text-xs text-muted">Weekly summary</p>
                                </div>
                                <button onClick={() => onToggle('email')} className="text-neon">
                                    <Icon icon={settings.email ? 'ToggleRight' : 'ToggleLeft'} size={32} className={settings.email ? 'text-neon' : 'text-muted'} />
                                </button>
                            </div>
                        </div>
                        <button onClick={onClose} className="w-full mt-8 bg-white/5 py-3 rounded-xl text-white font-bold text-sm">Close</button>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [filter, setFilter] = useState('All');
            const [notifications, setNotifications] = useState(INITIAL_DATA);
            const [hasUnread, setHasUnread] = useState(true); 
            const [activeTab, setActiveTab] = useState('notifs');
            const [isFilterOpen, setIsFilterOpen] = useState(false);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            
            const [settings, setSettings] = useState({
                showCount: true,
                push: true,
                email: false
            });

            useEffect(() => {
                if (activeTab === 'notifs') setHasUnread(false);
            }, [activeTab]);

            // Simulate incoming
            useEffect(() => {
                const timer = setTimeout(() => {
                    if (activeTab !== 'notifs') setHasUnread(true);
                    setNotifications(prev => [{
                        id: `new_${Date.now()}`,
                        type: "social",
                        title: "New Interaction",
                        desc: "Someone just liked your review on 'iPhone 15'.",
                        time: "Just now",
                        unread: true,
                        icon: "User"
                    }, ...prev]);
                }, 10000);
                return () => clearTimeout(timer);
            }, [activeTab]);

            const handleSwipeV2 = (id, action) => {
                vibrate(10);
                setNotifications(prev => prev.map(n => 
                    n.id === id ? { ...n, _status: 'deleted', _action: action, _deleteTime: Date.now() } : n
                ));
            };

            const handleUndoV2 = (id) => {
                vibrate(5);
                setNotifications(prev => prev.map(n => 
                    n.id === id ? { ...n, _status: 'active', _action: null } : n
                ));
            };

            const handleDismissV2 = (id) => {
                setNotifications(prev => prev.filter(n => n.id !== id));
            };

            const markAsRead = (id) => {
                setNotifications(prev => prev.map(n => n.id === id ? { ...n, unread: false } : n));
            };

            const toggleSetting = (key) => {
                vibrate(5);
                setSettings(prev => ({ ...prev, [key]: !prev[key] }));
            };

            const filteredList = useMemo(() => {
                let list = notifications;
                if (filter === 'Unread') list = list.filter(n => n.unread);
                if (filter === 'System') list = list.filter(n => ['system', 'security', 'revenue'].includes(n.type));
                if (filter === 'Brand Activity') list = list.filter(n => n.type === 'brand_seen');
                if (filter === 'Mentions') list = list.filter(n => n.type === 'social');
                return list;
            }, [filter, notifications]);

            const unreadCount = notifications.filter(n => n.unread && n._status !== 'deleted').length;

            return (
                <div className="flex-1 flex flex-col h-full relative bg-[#020205]">
                    
                    {/* Header */}
                    <div className="header-glass h-[65px] flex items-center justify-between px-6 sticky top-0 z-30 shrink-0">
                        <div className="flex items-center gap-2">
                            <span className="font-heading font-bold text-xl tracking-tight text-white">Notifications</span>
                            {settings.showCount && unreadCount > 0 && (
                                <div className="flex items-center gap-1.5 ml-2">
                                    <span className="text-[12px] font-bold text-neon">{unreadCount} New</span>
                                    <span className="w-1.5 h-1.5 rounded-full bg-neon animate-pulse shadow-[0_0_8px_var(--neon)]"></span>
                                </div>
                            )}
                        </div>
                        
                        <div className="flex gap-2">
                            <button onClick={() => setIsFilterOpen(true)} className={`w-9 h-9 flex items-center justify-center rounded-full border transition-colors active:scale-90 ${filter !== 'All' ? 'bg-neon/10 border-neon text-neon' : 'bg-white/5 border-white/10 text-muted hover:text-white'}`}>
                                <Icon icon="Filter" size={18} />
                            </button>
                            <button onClick={() => setIsSettingsOpen(true)} className="w-9 h-9 flex items-center justify-center rounded-full bg-white/5 border border-white/10 text-muted hover:text-white transition-colors active:scale-90">
                                <Icon icon="Settings" size={18} />
                            </button>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="flex-1 overflow-y-auto px-0 pt-0 pb-28 no-scrollbar">
                        {/* Active Filter Indicator */}
                        {filter !== 'All' && (
                            <div className="px-6 py-2 flex items-center gap-2">
                                <span className="text-xs text-muted">Showing:</span>
                                <span className="text-xs text-white font-bold bg-white/10 px-2 py-0.5 rounded">{filter}</span>
                                <button onClick={() => setFilter('All')} className="text-xs text-neon font-bold ml-auto">Clear</button>
                            </div>
                        )}

                        <AnimatePresence mode='popLayout'>
                            {filteredList.length > 0 ? (
                                filteredList.map(n => {
                                    if (n._status === 'deleted') {
                                        return (
                                            <motion.div
                                                key={n.id}
                                                layout
                                                initial={{ opacity: 0, height: 0 }}
                                                animate={{ opacity: 1, height: 'auto' }}
                                                exit={{ opacity: 0, height: 0 }}
                                            >
                                                <UndoRow 
                                                    action={n._action} 
                                                    onUndo={() => handleUndoV2(n.id)}
                                                    onDismiss={() => handleDismissV2(n.id)}
                                                />
                                            </motion.div>
                                        );
                                    }
                                    return (
                                        <motion.div 
                                            key={n.id}
                                            layout
                                            initial={{ opacity: 0, height: 0 }}
                                            animate={{ opacity: 1, height: 'auto' }}
                                            exit={{ opacity: 0, height: 0 }}
                                        >
                                            <NotificationItem 
                                                data={n} 
                                                onSwipe={handleSwipeV2} 
                                                onClick={markAsRead} 
                                            />
                                        </motion.div>
                                    );
                                })
                            ) : (
                                <div className="flex flex-col items-center justify-center h-64 opacity-30">
                                    <div className="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4">
                                        <Icon icon="Bell" size={24} className="text-white" />
                                    </div>
                                    <p className="text-xs font-medium text-white">No notifications</p>
                                </div>
                            )}
                        </AnimatePresence>
                        
                        <div className="py-8 flex flex-col items-center gap-3 opacity-30">
                            <div className="w-12 h-[1px] bg-gradient-to-r from-transparent via-white to-transparent"></div>
                            <span className="text-[10px] uppercase tracking-[0.2em] font-medium text-white">End of List</span>
                        </div>
                    </div>

                    {/* Modals */}
                    <FilterModal 
                        isOpen={isFilterOpen} 
                        onClose={() => setIsFilterOpen(false)} 
                        activeFilter={filter} 
                        onSelect={(f) => { setFilter(f); setIsFilterOpen(false); }} 
                    />
                    <SettingsModal 
                        isOpen={isSettingsOpen} 
                        onClose={() => setIsSettingsOpen(false)} 
                        settings={settings}
                        onToggle={toggleSetting}
                    />

                    {/* Bottom Nav */}
                    <BottomNav activeTab={activeTab} hasUnread={hasUnread} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
